<!doctype html>
<html lang="dv">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>BarefeetMV.hissabu ðŸ‘£</title>

<link rel="manifest" href='data:application/json,{
 "name":"BarefeetMV.hissabu",
 "short_name":"BarefeetMV",
 "display":"standalone",
 "start_url":".",
 "background_color":"#02070a",
 "theme_color":"#021820"
}'>

<style>
html,body{margin:0;background:#02070a;color:#cfefff;font-family:sans-serif;overflow:hidden}
canvas{display:block}
#ui{position:absolute;top:8px;left:8px;font-size:14px}
#next{margin-top:6px;opacity:.8}
button{background:#033;color:#9ff;border:1px solid #055;padding:4px 8px}
</style>
</head>
<body>

<canvas id="c"></canvas>
<div id="ui">
  <div id="score"></div>
  <div id="next"></div>
  <button onclick="undo()">âŸ²</button>
</div>

<script>
/* ======================================================
   BAREFEETMV.HISSABU â€” THREES (MALDIVIAN EDITION)
====================================================== */

const c = document.getElementById("c")
const ctx = c.getContext("2d")
let W,H,DPR
function resize(){
  DPR=devicePixelRatio||1
  W=c.width=innerWidth*DPR
  H=c.height=innerHeight*DPR
}
addEventListener("resize",resize); resize()

/* ================= DAILY SEED ================= */
const today = Math.floor(Date.now()/86400000)
function rng(seed){return()=>seed=Math.sin(seed)*1e4%1}
const rand = rng(today)

/* ================= DHIVEHI ================= */
const DV={
  1:"Þ‡Þ¬Þ‡Þ°",
  2:"Þ‹Þ¬",
  3:"ÞŒÞ¨Þ‚Þ°",
  6:"Þ€Þ¦",
  12:"Þ„Þ§ÞƒÞ¦",
  24:"ÞÞ§Þ‹Þ¦",
  48:"Þ‡Þ¦ÞÞ°Þ‹Þ¨Þ€Þ¦",
  96:"Þ‚ÞªÞˆÞ¦Þ‹Þ¨Þ€Þ¦",
  192:"Þ‹Þ¬ÞˆÞ¨Þ€Þ¦"
}

/* ================= AUDIO ================= */
const audio=new (AudioContext||webkitAudioContext)()
function hum(f){
  const o=audio.createOscillator(),g=audio.createGain()
  o.frequency.value=f;o.type="sine"
  g.gain.value=.02
  o.connect(g).connect(audio.destination)
  o.start();setTimeout(()=>o.stop(),200)
}

/* ================= GAME STATE ================= */
const N=4
let grid=[...Array(N)].map(()=>Array(N).fill(0))
let score=0
let best=+localStorage.best||0
let nextTile = rand()<.5?1:2
let prevState=null

function spawn(){
  const empties=[]
  for(let y=0;y<N;y++)for(let x=0;x<N;x++)
    if(!grid[y][x]) empties.push([x,y])
  if(!empties.length) return
  const [x,y]=empties[rand()*empties.length|0]
  grid[y][x]=nextTile
  nextTile = rand()<.5?1:2
}

/* ================= MOVE ================= */
function save(){
  prevState=JSON.stringify({grid,score,nextTile})
}
function undo(){
  if(!prevState) return
  const s=JSON.parse(prevState)
  grid=s.grid;score=s.score;nextTile=s.nextTile
}

function slide(dx,dy){
  save()
  let moved=false
  for(let i=0;i<N;i++){
    let line=[]
    for(let j=0;j<N;j++){
      const x=dx?dx>0?N-1-j:j:i
      const y=dy?dy>0?N-1-j:j:i
      if(grid[y][x]) line.push(grid[y][x])
    }
    let res=[]
    for(let k=0;k<line.length;k++){
      if(line[k]==1&&line[k+1]==2||
         line[k]==2&&line[k+1]==1){
        res.push(3); score+=3; k++
      } else if(line[k]>=3&&line[k]==line[k+1]){
        res.push(line[k]*2); score+=line[k]*2; k++
      } else res.push(line[k])
    }
    while(res.length<N) res.push(0)
    for(let j=0;j<N;j++){
      const x=dx?dx>0?N-1-j:j:i
      const y=dy?dy>0?N-1-j:j:i
      if(grid[y][x]!=res[j]) moved=true
      grid[y][x]=res[j]
    }
  }
  if(moved){ spawn(); hum(100+score%200) }
  best=Math.max(best,score); localStorage.best=best
}

/* ================= INPUT ================= */
addEventListener("keydown",e=>{
  if(e.key=="ArrowUp")slide(0,-1)
  if(e.key=="ArrowDown")slide(0,1)
  if(e.key=="ArrowLeft")slide(-1,0)
  if(e.key=="ArrowRight")slide(1,0)
})

let sx,sy
c.onpointerdown=e=>{sx=e.clientX;sy=e.clientY;audio.resume()}
c.onpointerup=e=>{
  const dx=e.clientX-sx,dy=e.clientY-sy
  if(Math.abs(dx)+Math.abs(dy)<30) return
  Math.abs(dx)>Math.abs(dy)
   ? slide(dx>0?1:-1,0)
   : slide(0,dy>0?1:-1)
}

/* ================= RENDER ================= */
function draw(){
  ctx.clearRect(0,0,W,H)
  const s=Math.min(W,H)*.8/N
  ctx.translate(W/2-s*N/2,H/2-s*N/2)

  for(let y=0;y<N;y++)for(let x=0;x<N;x++){
    ctx.strokeStyle="#044";ctx.strokeRect(x*s,y*s,s,s)
    const v=grid[y][x]
    if(!v)continue
    const h=180+Math.log2(v)*25
    ctx.fillStyle=`hsl(${h},80%,55%)`
    ctx.beginPath()
    ctx.arc(x*s+s/2,y*s+s/2,s*.35,0,Math.PI*2)
    ctx.fill()
    ctx.fillStyle="#fff"
    ctx.textAlign="center";ctx.textBaseline="middle"
    ctx.font=`${s*.28}px sans-serif`
    ctx.fillText(DV[v]||"Þ„Þ®Þ‘Þª",x*s+s/2,y*s+s/2)
  }
  ctx.resetTransform()
  scoreDiv.textContent=`ÞÞ°Þ†Þ¯ÞƒÞª ${score}  âˆž ${best}`
  nextDiv.textContent=`Þ‹Þ¬Þ‚Þ°  ${DV[nextTile]}`
}

const scoreDiv=document.getElementById("score")
const nextDiv=document.getElementById("next")

spawn();spawn()
requestAnimationFrame(function loop(){
  draw();requestAnimationFrame(loop)
})
</script>
</body>
</html>